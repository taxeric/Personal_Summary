æ‰€è°“æµå¼å¸ƒå±€ï¼Œå°±æ˜¯ç±»ä¼¼æ·˜å®/äº¬ä¸œç­‰APPæœç´¢å†å²çš„æ ·å­ï¼Œæœ‰äº†å‰é¢çš„å­¦ä¹ ï¼Œè¿™ä¸ªåº”è¯¥æ¯”è¾ƒå¥½å®ç°ï¼Œç›´æ¥ä¸Šä»£ç 

# é™æ€é¡µé¢å¡«å……ViewGroup
```java
    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        //ç”±äºæ˜¯é‡å†™ViewGroupæ¥è‡ªå®šä¹‰Viewï¼Œæ‰€ä»¥æ³¨é‡Šæ‰ä¹‹å‰æµ‹é‡çš„å€¼
        //super.onMeasure(widthMeasureSpec, heightMeasureSpec);

        //è·å–è‡ªèº«å»ºè®®çš„å®½åº¦
        int myWidth = MeasureSpec.getSize(widthMeasureSpec);
        //ä¸Šä¸€ä¸ªå­Viewçš„å®½åº¦
        int lastViewWidth = 0;

        //æµ‹é‡å®Œæ‰€æœ‰çš„å­Viewåè‡ªèº«åº”è¯¥æœ‰å¤šé«˜
        int measureHeight = 0;

        //å­Viewçš„æ•°é‡
        int childCount = getChildCount();
        for (int i = 0; i < childCount; i ++){

            //è·å–åˆ°å­View
            View childView = getChildAt(i);

            //æµ‹é‡å¹¶ä¿å­˜å­Viewçš„å°ºå¯¸
            measureChild(childView, widthMeasureSpec, heightMeasureSpec);

            //è·å–å½“å‰å­Viewæµ‹é‡å¾—åˆ°çš„å®½åº¦
            int childWidth = childView.getMeasuredWidth();

            //å¦‚æœå½“å‰å­Viewå®½åº¦ + ä¸Šä¸€ä¸ªå­Viewå®½åº¦ > è‡ªèº«çš„å®½åº¦
            if (childWidth + lastViewWidth > myWidth){
                //æ­¤æ—¶å°±è¦æ¢è¡Œäº†
                measureHeight += childView.getMeasuredHeight();
                //å¹¶ä¸”æ¢è¡ŒålastViewWidthçš„å€¼å°±æ˜¯ç¬¬ä¸€ä¸ªå­Viewçš„å®½åº¦
                lastViewWidth = childView.getMeasuredWidth();
                i("æ¢è¡Œ " + i + "    " + measureHeight);
            }else {
                //å¦åˆ™å°±åªåŠ ä¸Šå½“å‰å­Viewå®½åº¦å°±å¥½
                lastViewWidth += childWidth;
            }
            //å¯¹æœ€åä¸€ä¸ªå­Viewå¤„ç†ï¼Œå¦‚æœæ²¡åšå¤„ç†ï¼Œåˆ™measureHeightçš„å€¼åªæ˜¯
            //æ¢è¡Œä¹‹å‰çš„å€¼ï¼Œè€Œæ¢è¡Œä¹‹åçš„é«˜åº¦æ²¡æœ‰åŠ ä¸Šï¼Œè¿™å°±å¯¼è‡´å°‘æ˜¾ç¤ºä¸€è¡Œ
            //åˆ¤æ–­æ˜¯å¦æ‰§è¡Œåˆ°æœ€åä¸€ä¸ªå­Viewï¼Œèƒ½å§‹ç»ˆä¿è¯åŠ ä¸Šæœ€åä¸€è¡Œçš„é«˜åº¦
            if (i == childCount - 1){
                measureHeight += childView.getMeasuredHeight();
            }
        }

        //æœ€åä¿å­˜è‡ªèº«åº”è¯¥æœ‰çš„å®½åº¦å’Œé«˜åº¦
        setMeasuredDimension(widthMeasureSpec, measureHeight);
    }
    
    
    @Override
    protected void onLayout(boolean changed, int l, int t, int r, int b) {
        //å­Viewçš„å·¦è¾¹ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å­Viewå·¦ä¸Šç‚¹çš„Xè½´åæ ‡ï¼Œä¹Ÿå°±æ˜¯ä»å·¦è¾¹å“ªé‡Œå¼€å§‹å¸ƒå±€
        int layoutLeft = l;
        //å­Viewçš„é¡¶è¾¹ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å­Viewå·¦ä¸Šç‚¹çš„Yè½´åæ ‡ï¼Œä¹Ÿå°±æ˜¯ä»é¡¶è¾¹å“ªé‡Œå¼€å§‹å¸ƒå±€
        int layoutHeight = 0;
        //è·å–ViewGroupæµ‹å¾—çš„å®½åº¦
        int parentWidth = getMeasuredWidth();
        //è·å–å­Viewçš„æ•°é‡
        int childCount = getChildCount();
        for (int i = 0; i < childCount; i ++){

            //è·å–åˆ°å­View
            View childView = getChildAt(i);

            //è·å–åˆ°å­Viewæµ‹é‡å¾—åˆ°çš„å®½é«˜
            int childWidth = childView.getMeasuredWidth();
            int childHeight = childView.getMeasuredHeight();

            //è¿™é‡Œä¾æ—§åˆ¤æ–­ï¼Œæ˜¯å¦è¶…å‡ºViewGroupçš„å®½åº¦
            if (childWidth + layoutLeft > parentWidth){
                //å¦‚æœè¶…å‡ºå°±å¢åŠ å½“å‰å­Viewçš„é«˜åº¦
                layoutHeight += childHeight;
                //ç„¶åæŠŠä¸‹ä¸€è¡Œå¼€å§‹çš„å­Viewå·¦è¾¹ä½ç½®è®¾ç½®ä¸º0
                //ç¡®ä¿æ¯æ¬¡éƒ½èƒ½ä»xè½´åæ ‡ä¸º0å¼€å§‹å¸ƒå±€
                layoutLeft = 0;
            }

            //å¸ƒå±€ï¼ˆå­Viewçš„å·¦è¾¹ï¼Œå­Viewçš„é¡¶è¾¹ï¼Œå­Viewçš„å³è¾¹ = å·¦è¾¹ + å½“å‰å­Viewçš„å®½åº¦ï¼Œå­Viewçš„åº•è¾¹ = æµ‹å¾—çš„é«˜åº¦ + å½“å‰å­Viewçš„é«˜åº¦ï¼‰
            childView.layout(layoutLeft, layoutHeight, layoutLeft + childWidth, layoutHeight + childHeight);
            //æ¯æ¬¡å¸ƒå±€åï¼Œéœ€è¦æŠŠå­Viewçš„å·¦è¾¹åŠ ä¸Šå½“å‰å­Viewçš„å®½åº¦ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªå­Viewå·¦è¾¹çš„èµ·å§‹ä½ç½®
            layoutLeft += childWidth;
        }
    }
```
å†™çš„å¾ˆæ¸…æ¥šæ˜ç™½äº†ï¼Œç›´æ¥åœ¨xmlä¸­ç”¨å³å¯
```xml
    <com.eric.study.FlowLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content">

        <TextView
            android:text="200"
            android:gravity="center"
            android:layout_width="200dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="20"
            android:gravity="center"
            android:layout_width="20dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="60"
            android:gravity="center"
            android:layout_width="60dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="100"
            android:gravity="center"
            android:layout_width="100dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="120"
            android:gravity="center"
            android:layout_width="120dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="200"
            android:gravity="center"
            android:layout_width="200dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="60"
            android:gravity="center"
            android:layout_width="60dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="60"
            android:gravity="center"
            android:layout_width="60dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="60"
            android:gravity="center"
            android:layout_width="60dp"
            android:layout_height="wrap_content"/>
        <TextView
            android:text="60"
            android:gravity="center"
            android:layout_width="60dp"
            android:layout_height="wrap_content"/>
    </com.eric.study.FlowLayout>
```
## ä¿®æ”¹1
ä¿®æ”¹xmlå¸ƒå±€ï¼ŒæŠŠè‡ªå®šä¹‰ViewGroupçš„é«˜åº¦æ”¹ä¸º`match_parent`æ—¶å‘ç°è¿˜æ˜¯åŒ…è£¹å­æ§ä»¶ï¼Œè¿™æ˜¯å› ä¸ºåœ¨onMeasureæ–¹æ³•ä¸­ï¼Œæ²¡æœ‰å¯¹è‡ªå®šä¹‰ViewGroupçš„æµ‹é‡æ¨¡å¼åˆ¤æ–­ï¼Œæœ€åä¿å­˜çš„é«˜åº¦æ€»æ˜¯æ°å¥½åŒ…è£¹æ‰€æœ‰å­æ§ä»¶çš„é«˜åº¦ã€‚å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œç›´æ¥åˆ¤æ–­ä¸€ä¸‹é«˜åº¦çš„æµ‹é‡æ¨¡å¼å°±è¡Œ
```java
    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        //ç”±äºæ˜¯é‡å†™ViewGroupæ¥è‡ªå®šä¹‰Viewï¼Œæ‰€ä»¥æ³¨é‡Šæ‰ä¹‹å‰æµ‹é‡çš„å€¼
        //super.onMeasure(widthMeasureSpec, heightMeasureSpec);

        //è·å–è‡ªèº«å»ºè®®çš„å®½åº¦
        int myWidth = MeasureSpec.getSize(widthMeasureSpec);

        //æµ‹é‡å®Œæ‰€æœ‰çš„å­Viewåè‡ªèº«åº”è¯¥æœ‰å¤šé«˜
        int measureHeight = 0;
        if (myHeightMode == MeasureSpec.AT_MOST){
            //ä¸Šä¸€ä¸ªå­Viewçš„å®½åº¦
            int lastViewWidth = 0;

            //å­Viewçš„æ•°é‡
            int childCount = getChildCount();
            for (int i = 0; i < childCount; i ++){

                //è·å–åˆ°å­View
                View childView = getChildAt(i);

                //æµ‹é‡å¹¶ä¿å­˜å­Viewçš„å°ºå¯¸
                measureChild(childView, widthMeasureSpec, heightMeasureSpec);

                //è·å–å½“å‰å­Viewæµ‹é‡å¾—åˆ°çš„å®½åº¦
                int childWidth = childView.getMeasuredWidth();

                //å¦‚æœå½“å‰å­Viewå®½åº¦ + ä¸Šä¸€ä¸ªå­Viewå®½åº¦ > è‡ªèº«çš„å®½åº¦
                if (childWidth + lastViewWidth > myWidth){
                    //æ­¤æ—¶å°±è¦æ¢è¡Œäº†
                    measureHeight += childView.getMeasuredHeight();
                    //å¹¶ä¸”æ¢è¡Œåç¬¬ä¸€ä¸ªå­Viewçš„å®½åº¦å°±æ˜¯å½“å‰å­Viewçš„å®½åº¦
                    lastViewWidth = childView.getMeasuredWidth();
                }else {
                    //å¦åˆ™å°±åªåŠ ä¸Šå½“å‰å­Viewå®½åº¦å°±å¥½
                    lastViewWidth += childWidth;
                }
                
                if (i == childCount - 1){
                    measureHeight += childView.getMeasuredHeight();
                }
            }
        }else if (myHeightMode == MeasureSpec.EXACTLY){
            measureChildren(widthMeasureSpec, heightMeasureSpec);
            measureHeight = MeasureSpec.getSize(heightMeasureSpec);
        }

        //æœ€åä¿å­˜è‡ªèº«åº”è¯¥æœ‰çš„å®½åº¦å’Œé«˜åº¦
        setMeasuredDimension(widthMeasureSpec, measureHeight);
    }
```
## ä¿®æ”¹2
å½“ç»™å­ViewåŠ ä¸Šmarginå±æ€§æ—¶å‘ç°ä¿®æ”¹æ— æ•ˆã€‚è¿™æ˜¯å› ä¸ºåœ¨è‡ªå®šä¹‰ViewGroupä¸­æ²¡æœ‰å¯¹å­æ§ä»¶çš„Marginå±æ€§åšå¤„ç†ã€‚æ—¢ç„¶æ˜¯å¸ƒå±€é‡Œçš„å‚æ•°ï¼Œå°±ä¼šæƒ³åˆ°ä¹‹å‰è¯´è¿‡çš„**LayoutParams**ï¼Œä½†é‡Œé¢æ²¡æœ‰å…³äºmarginçš„æè¿°ï¼Œæ‰€ä»¥å’±çœ‹çœ‹å®ƒçš„å­ç±»ï¼Œæ‰¾åˆ°ä¸ªå«**MarginLayoutParams**çš„ä¸œè¥¿ï¼Œéå¸¸ç›¸ä¼¼ï¼Œç™¾åº¦ä¸€æ³¢ï¼Œç»“æœä¸é¢„æœŸä¸€è‡´ã€‚ä½¿ç”¨å¦‚ä¸‹ï¼š
```java
MarginLayoutParams params = (MarginLayoutParams) childView.getLayoutParams();
int leftMargin = params.leftMargin;
...
```
OKå°±è¿™æ ·ï¼Œä¿®æ”¹ä»£ç 
```java
    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        //ç”±äºæ˜¯é‡å†™ViewGroupæ¥è‡ªå®šä¹‰Viewï¼Œæ‰€ä»¥æ³¨é‡Šæ‰ä¹‹å‰æµ‹é‡çš„å€¼
        //super.onMeasure(widthMeasureSpec, heightMeasureSpec);

        //è·å–è‡ªèº«å»ºè®®çš„å®½åº¦ã€è‡ªèº«é«˜åº¦æµ‹é‡æ¨¡å¼
        int myWidth = MeasureSpec.getSize(widthMeasureSpec);
        int myHeightMode = MeasureSpec.getMode(heightMeasureSpec);

        //æµ‹é‡å®Œæ‰€æœ‰çš„å­Viewåè‡ªèº«åº”è¯¥æœ‰å¤šé«˜
        int measureHeight = 0;
        //åˆ¤æ–­é«˜åº¦æµ‹é‡æ¨¡å¼ï¼Œå¦‚æœæ˜¯wrap_content
        if (myHeightMode == MeasureSpec.AT_MOST){
            //ä¸Šä¸€ä¸ªå­Viewçš„å®½åº¦
            int lastViewWidth = 0;

            //å­Viewçš„æ•°é‡
            int childCount = getChildCount();
            for (int i = 0; i < childCount; i ++){

                //è·å–åˆ°å­View
                View childView = getChildAt(i);

                //è·å–åˆ°å·¦å³ä¸Šä¸‹çš„margin
                MarginLayoutParams params = (MarginLayoutParams) childView.getLayoutParams();
                int leftMargin = params.leftMargin;
                int rightMargin = params.rightMargin;
                int topMargin = params.topMargin;
                int bottomMargin = params.bottomMargin;

                //æµ‹é‡å¹¶ä¿å­˜å­Viewçš„å°ºå¯¸
                measureChild(childView, widthMeasureSpec, heightMeasureSpec);

                //è·å–å½“å‰å­Viewæµ‹é‡å¾—åˆ°çš„å®½åº¦ï¼Œéœ€è¦åŠ ä¸Šå·¦å³çš„Marginå€¼
                int childWidth = childView.getMeasuredWidth() + leftMargin + rightMargin;

                //å¦‚æœå½“å‰å­Viewå®½åº¦ + ä¸Šä¸€ä¸ªå­Viewå®½åº¦ > è‡ªèº«çš„å®½åº¦
                if (childWidth + lastViewWidth > myWidth){
                    //æ­¤æ—¶å°±è¦æ¢è¡Œäº†ï¼Œå¹¶ä¸”è¯¥å€¼ä¹Ÿéœ€è¦åŠ ä¸Šå½“å‰å­Viewçš„ä¸Šä¸‹Marginå€¼
                    measureHeight += childView.getMeasuredHeight() + topMargin + bottomMargin;
                    //å¹¶ä¸”æ¢è¡Œåç¬¬ä¸€ä¸ªå­Viewçš„å®½åº¦å°±æ˜¯å½“å‰å­Viewçš„å®½åº¦ + å½“å‰å­Viewçš„å·¦å³Marginå€¼
                    lastViewWidth = childView.getMeasuredWidth() + leftMargin + rightMargin;
                }else {
                    //å¦åˆ™ä¸Šä¸€ä¸ªå­Viewçš„å®½åº¦å°±åªåŠ ä¸Šå½“å‰å­Viewå®½åº¦å°±å¥½
                    lastViewWidth += childWidth;
                }
                //ç¡®ä¿æµ‹é‡å®Œæ‰€æœ‰å­ViewååŠ ä¸Šæœ€åä¸€è¡Œçš„é«˜åº¦ï¼Œå¤–å¸¦æœ€åä¸€ä¸ªå­Viewçš„å·¦å³Margin
                //å…¶å®è¿™é‡Œå†™çš„æœ‰ç‚¹é—®é¢˜ï¼Œå¾—çœ‹æ¯ä¸€è¡Œè°çš„é«˜åº¦æœ€å¤§ï¼Œå–æœ€å¤§å€¼æ¯”è¾ƒ
                //è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œå°±å‡è®¾æ‰€æœ‰çš„å­Viewéƒ½ç”¨çš„ç›¸åŒé«˜åº¦å’Œç›¸åŒMarginå€¼
                if (i == childCount - 1){
                    measureHeight += childView.getMeasuredHeight() + topMargin + bottomMargin;
                }
            }
        }else if (myHeightMode == MeasureSpec.EXACTLY){
            //å¦‚æœæ˜¯match_parentæˆ–è€…ç¡®å®šå€¼ï¼Œå°±ç›´æ¥æµ‹é‡ï¼Œæœ€ç»ˆé«˜åº¦å°±æ˜¯å»ºè®®çš„é«˜åº¦
            measureChildren(widthMeasureSpec, heightMeasureSpec);
            measureHeight = MeasureSpec.getSize(heightMeasureSpec);
        }

        //æœ€åä¿å­˜è‡ªèº«åº”è¯¥æœ‰çš„å®½åº¦å’Œé«˜åº¦
        setMeasuredDimension(widthMeasureSpec, measureHeight);
    }
    
    @Override
    protected void onLayout(boolean changed, int l, int t, int r, int b) {
        //å­Viewçš„å·¦è¾¹ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å­Viewå·¦ä¸Šç‚¹çš„Xè½´åæ ‡ï¼Œä¹Ÿå°±æ˜¯ä»å·¦è¾¹å“ªé‡Œå¼€å§‹å¸ƒå±€
        int layoutLeft = l;
        //å­Viewçš„é¡¶è¾¹ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å­Viewå·¦ä¸Šç‚¹çš„Yè½´åæ ‡ï¼Œä¹Ÿå°±æ˜¯ä»é¡¶è¾¹å“ªé‡Œå¼€å§‹å¸ƒå±€
        int layoutHeight = 0;
        //è·å–ViewGroupæµ‹å¾—çš„å®½åº¦
        int parentWidth = getMeasuredWidth();
        //æ‘†æ”¾å­View
        int childCount = getChildCount();
        for (int i = 0; i < childCount; i ++){

            //è·å–åˆ°å­View
            View childView = getChildAt(i);

            //è·å–åˆ°å­Viewæµ‹é‡å¾—åˆ°çš„å®½é«˜
            int childWidth = childView.getMeasuredWidth();
            int childHeight = childView.getMeasuredHeight();

            //è·å–åˆ°å·¦å³ä¸Šä¸‹çš„margin
            MarginLayoutParams params = (MarginLayoutParams) childView.getLayoutParams();
            int leftMargin = params.leftMargin;
            int rightMargin = params.rightMargin;
            int topMargin = params.topMargin;
            int bottomMargin = params.bottomMargin;

            //è¿™é‡Œä¾æ—§åˆ¤æ–­ï¼Œæ˜¯å¦è¶…å‡ºViewGroupçš„å®½åº¦ï¼Œä½†æ˜¯è¦åŠ ä¸Šå­Viewçš„å·¦å³Marginå€¼
            if (childWidth + layoutLeft + leftMargin + rightMargin > parentWidth){
                //å¦‚æœè¶…å‡ºå°±å¢åŠ å½“å‰å­Viewçš„é«˜åº¦ï¼Œå¤–å¸¦å­Viewçš„ä¸Šä¸‹Marginå€¼
                layoutHeight += childHeight + topMargin + bottomMargin;
                //ç„¶åæŠŠä¸‹ä¸€è¡Œå¼€å§‹çš„å­Viewå·¦è¾¹ä½ç½®è®¾ç½®ä¸º0
                //è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ¯æ¬¡æ¢è¡Œåéƒ½èƒ½ä»é¡¶ç‚¹xè½´åæ ‡ä¸º0å¼€å§‹å¸ƒå±€
                layoutLeft = 0;
            }

            //å¸ƒå±€ï¼ˆå­Viewçš„å·¦è¾¹ï¼Œå­Viewçš„é¡¶è¾¹ï¼Œå­Viewçš„å³è¾¹ = å·¦è¾¹ + å½“å‰å­Viewçš„å®½åº¦ï¼Œå­Viewçš„åº•è¾¹ = æµ‹å¾—çš„é«˜åº¦ + å½“å‰å­Viewçš„é«˜åº¦ï¼‰
            childView.layout(layoutLeft + leftMargin,
                    layoutHeight + topMargin,
                    //è¿™é‡Œä¸éœ€è¦æ·»åŠ å­Viewå³è¾¹Marginå€¼ï¼Œå› ä¸ºä¸‹é¢å·²ç»åŠ ä¸Šäº†
                    layoutLeft + childWidth + leftMargin,
                    //åŒæ ·ï¼Œè¿™é‡Œä¹Ÿä¸éœ€è¦æ·»åŠ å­Viewåº•è¾¹çš„Marginå€¼äº†
                    layoutHeight + childHeight + topMargin);
                    
            //æ¯æ¬¡å¸ƒå±€åï¼Œéœ€è¦æŠŠå­Viewçš„å·¦è¾¹åŠ ä¸Šå½“å‰å­Viewçš„å®½åº¦ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªå­Viewå·¦è¾¹çš„èµ·å§‹ä½ç½®
            layoutLeft += childWidth + leftMargin + rightMargin;
        }
    }
```
emmmï¼Œè¿è¡Œä¸€æ³¢

é—ªé€€äº† -_-||

çœ‹çœ‹æŠ¥é”™ï¼š`ViewGroup$LayoutParams cannot be cast to android.view.ViewGroup$MarginLayoutParams`

ä¸èƒ½å¼ºè½¬ï¼Ÿï¼æ¥å§ï¼Œç™¾åº¦ä¸€æ³¢

åœ¨å’±è‡ªå®šä¹‰æµå¼å¸ƒå±€ä¸­ï¼Œå› ä¸ºæ˜¯é™æ€é¡µé¢ï¼Œæ‰€ä»¥activityä¼šè°ƒç”¨`setContentView()`æ–¹æ³•æ¥åˆ›å»ºå¸ƒå±€ï¼Œå®ç°å¦‚ä¸‹
```java
    @Override
    public void setContentView(int resId) {
        ensureSubDecor();
        ViewGroup contentParent = mSubDecor.findViewById(android.R.id.content);
        contentParent.removeAllViews();
        LayoutInflater.from(mContext).inflate(resId, contentParent);
        mAppCompatWindowCallback.getWrapped().onContentChanged();
    }
```
çœ‹inflateæ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ï¼š
```java
    public View inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot) {
        final Resources res = getContext().getResources();
        ...
        View view = tryInflatePrecompiled(resource, res, root, attachToRoot);
        if (view != null) {
            return view;
        }
        XmlResourceParser parser = res.getLayout(resource);
        try {
            return inflate(parser, root, attachToRoot);
        } finally {
            parser.close();
        }
    }
    
    public View inflate(XmlPullParser parser, @Nullable ViewGroup root, boolean attachToRoot) {
        synchronized (mConstructorArgs) {
            Trace.traceBegin(Trace.TRACE_TAG_VIEW, "inflate");

            final Context inflaterContext = mContext;
            final AttributeSet attrs = Xml.asAttributeSet(parser);
            Context lastContext = (Context) mConstructorArgs[0];
            mConstructorArgs[0] = inflaterContext;
            View result = root;

            try {
                advanceToRootNode(parser);
                final String name = parser.getName();
                ...

                if (TAG_MERGE.equals(name)) {
                    if (root == null || !attachToRoot) {
                        throw new InflateException("<merge /> can be used only with a valid "
                                + "ViewGroup root and attachToRoot=true");
                    }

                    rInflate(parser, root, inflaterContext, attrs, false);
                } else {
                    // Temp is the root view that was found in the xml
                    final View temp = createViewFromTag(root, name, inflaterContext, attrs);
                    ViewGroup.LayoutParams params = null;
                    if (root != null) {
                        ...
                        // Create layout params that match root, if supplied
                        //åˆ›å»ºå¸ƒå±€å‚æ•°ç»™æ ¹å¸ƒå±€
                        params = root.generateLayoutParams(attrs);
                        if (!attachToRoot) {
                            temp.setLayoutParams(params);
                        }
                    }
                    ...
                    // å¡«å……æ‰€æœ‰å­View
                    rInflateChildren(parser, temp, attrs, true);
                    ...
                }
            } ...

            return result;
        }
    }
```
å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†`rInflateChildren`æ–¹æ³•æ¥å¡«å……å­Viewï¼Œå³å®Œæˆå­Viewåˆå§‹åŒ–ã€‚æœ€ç»ˆå®ç°å¦‚ä¸‹ï¼š
```java
    void rInflate(XmlPullParser parser, View parent, Context context,
            AttributeSet attrs, boolean finishInflate) throws XmlPullParserException, IOException {
        final int depth = parser.getDepth();
        int type;
        boolean pendingRequestFocus = false;
        while (((type = parser.next()) != XmlPullParser.END_TAG ||
                parser.getDepth() > depth) && type != XmlPullParser.END_DOCUMENT) {

            if (type != XmlPullParser.START_TAG) {
                continue;
            }
            final String name = parser.getName();
            if (TAG_REQUEST_FOCUS.equals(name)) {
                ...
            } else {
                final View view = createViewFromTag(parent, name, context, attrs);
                final ViewGroup viewGroup = (ViewGroup) parent;
                final ViewGroup.LayoutParams params = viewGroup.generateLayoutParams(attrs);
                rInflateChildren(parser, view, attrs, true);
                viewGroup.addView(view, params);
            }
        }
        ...
    }
```
è¿™é‡Œéå†æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œåˆ›å»ºå¯¹åº”çš„Viewå¯¹è±¡ï¼Œå¹¶ä¸”ç”¨äº†**å½“å‰ViewGroup**çš„`generateLayoutParams`æ–¹æ³•ç”ŸæˆLayoutParamsã€‚çœ‹å®ƒçš„å®ç°ï¼š
```java
    public LayoutParams generateLayoutParams(AttributeSet attrs) {
        return new LayoutParams(getContext(), attrs);
    }
    
    public LayoutParams(Context c, AttributeSet attrs) {
        TypedArray a = c.obtainStyledAttributes(attrs, R.styleable.ViewGroup_Layout);
        setBaseAttributes(a,
                R.styleable.ViewGroup_Layout_layout_width,
                R.styleable.ViewGroup_Layout_layout_height);
        a.recycle();
    }
```
å¯ä»¥çœ‹åˆ°åªé»˜è®¤ç”Ÿæˆäº†å®½åº¦å’Œé«˜åº¦ï¼Œå¹¶ä¸”è¿”å›çš„æ˜¯ViewGroupçš„LayoutParamså¯¹è±¡ï¼Œæ‰€ä»¥åœ¨ä¸Šé¢çš„å¼ºè½¬ä¸­å°±é—ªé€€äº†ï¼Œæ¯•ç«Ÿäººå®¶è¦çˆ¹ä½ éå¾—è½¬æˆå„¿å­ã€‚soï¼Œå’±éœ€è¦é‡å†™è¿™ä¸ªå‡½æ•°ï¼Œè®©å®ƒè¿”å›å„¿å­ï¼ˆå°±æ˜¯MarginLayoutParamsï¼‰ï¼Œç”¨äºè·å–marginçš„å‚æ•°å°±OK
```java
    //åœ¨è‡ªå®šä¹‰æµå¼å¸ƒå±€é‡Œé¢é‡å†™
    //ä¸ºå•¥è¦å…¨éƒ¨é‡å†™ï¼Ÿå› ä¸ºé™¤äº†åœ¨xmlé‡Œé¢é™æ€å†™å­Viewè¿˜å¯èƒ½åŠ¨æ€æ·»åŠ å­View
    @Override
    public ViewGroup.LayoutParams generateLayoutParams(AttributeSet attrs) {
        return new MarginLayoutParams(getContext(), attrs);
    }

    @Override
    protected ViewGroup.LayoutParams generateDefaultLayoutParams() {
        return new MarginLayoutParams(super.generateDefaultLayoutParams());
    }

    @Override
    protected ViewGroup.LayoutParams generateLayoutParams(ViewGroup.LayoutParams p) {
        return new MarginLayoutParams(p);
    }
```
å¥½äº†ï¼Œå†è¿è¡Œ...å®Œç¾

# åŠ¨æ€æ·»åŠ å­View
å®ç°é™æ€æ·»åŠ åå’±å¯ä»¥åšçš„æ›´ğŸªğŸºä¸€ç‚¹ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ å­Viewã€‚æœ‰å•¥æ€è·¯ï¼Ÿæ²¡å•¥æ€è·¯....è¿˜æ˜¯å…ˆçœ‹çœ‹åˆ«äººçš„æ€è·¯ã€‚æ—¢ç„¶æ˜¯åŠ¨æ€æ·»åŠ ï¼Œé‚£å°±ç”¨ViewGroupçš„addViewæ–¹æ³•ï¼Œå’±ä¹Ÿä¸ç”¨å†™ä»€ä¹ˆèŠ±é‡Œèƒ¡å“¨çš„ç•Œé¢äº†ï¼Œå°±åªç”¨TextViewæ˜¾ç¤ºå°±è¡Œï¼Œè€Œä¸”è¦æ ¹æ®å­Viewæ•°é‡æ¥æ”¹å˜é¡µé¢ï¼Œè¿™ä¸ªæ•°é‡ä»å“ªæ¥ï¼Ÿè€Œä¸”å­Viewèµ·ç å¾—å“åº”ç‚¹å‡»äº‹ä»¶å§ï¼ŸæŒ‰è¿™ä¸ªæ€è·¯ï¼Œå†³å®šç”¨ä¼ªé€‚é…å™¨çš„æ–¹æ³•åš

è¯´åˆ°äº†é€‚é…å™¨ï¼Œé‚£å°±è¦å’±çš„æµå¼å¸ƒå±€å¾—æœ‰ä¸ª`setAdapter`æ–¹æ³•ï¼Œè€Œä¸”éœ€è¦å­Viewå“åº”ç‚¹å‡»äº‹ä»¶ï¼Œå¾—åœ¨ViewGroupé‡Œé¢å†™ä¸€ä¸ªæ¥å£å‡ºæ¥ï¼Œä¸ºäº†æ–¹ä¾¿è®©activityçŸ¥é“å’±ç‚¹å‡»äº†ç¬¬å‡ ä¸ªï¼Œæ‰€ä»¥æ¥å£çš„å‚æ•°ç›´æ¥ææˆå½“å‰ç‚¹å‡»çš„ä¸‹æ ‡å°±è¡Œã€‚OKï¼Œé‚£å°±æ”¹ä¸‹ä»£ç ï¼š
```java
public class FlowLayout extends ViewGroup {
    ...
    @Override
    protected void onLayout(boolean changed, int l, int t, int r, int b) {
        ...
        for (int i = 0; i < childCount; i ++){

            mCurrentItemIndex ++;

            //è·å–åˆ°å­View
            View childView = getChildAt(i);
            setChildClick(childView);
        }
    }
    
    //ç”¨äºè®°å½•å½“å‰æ˜¯ç¬¬å‡ ä¸ªå­View
    private int mCurrentItemIndex = -1;

    //ä¸ºå­Viewæ·»åŠ ç‚¹å‡»äº‹ä»¶
    private void setChildClick(final View view){
        //å½“å­Viewå¸ƒå±€å®Œæˆåï¼ŒmCurrentItemIndexçš„å€¼åº”è¯¥ä¸ºå­Viewæ•°é‡-1ï¼Œ
        //è¿™é‡Œè¿™æ ·å†™æ˜¯é¿å…å­Viewç‚¹å‡»æ—¶å–åˆ°çš„ä¸‹æ ‡æ€»æ˜¯å­Viewçš„æ•°é‡-1
        if (view.getTag() == null){
            view.setTag(mCurrentItemIndex);
        }
        view.setOnClickListener(new OnClickListener() {
            @Override
            public void onClick(View v) {
                if (checkListener != null){
                    checkListener.onItemCheck((int) view.getTag());
                }
            }
        });
    }
    
    //å­Viewçš„ç‚¹å‡»äº‹ä»¶æ¥å£
    public interface OnTagCheckListener{
        void onItemCheck(int position);
    }
    private OnTagCheckListener checkListener;
    public void setOnCheckListener(OnTagCheckListener checkListener){
        this.checkListener = checkListener;
    }

    public void setAdapter(){
    }
}
```
OKï¼Œæƒ³æƒ³è¿™ä¸ªAdapterè¯¥å’‹å†™ã€‚æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯è‡ªå·±å†™ï¼Œä¸ç»§æ‰¿è‡ªå¸¦çš„é€‚é…å™¨æ¯”è¾ƒå¥½ã€‚å’±å…ˆå†™ä¸€ä¸ªç”¨äºè·å–å­Viewæ•°é‡çš„æ–¹æ³•ï¼Œè¯´åˆ°æ•°é‡ï¼Œè‚¯å®šä¼šæƒ³åˆ°é›†åˆï¼Œå› ä¸ºåªç”¨TextViewæ¥æ˜¾ç¤ºï¼Œæ‰€ä»¥å’±å°±æŠŠé›†åˆæ³›å‹æŒ‡å®šæˆStringå°±è¡Œ
```java
public class FlowAdapter {

    private Context context;
    private ArrayList<String> data;

    public FlowAdapter(Context context, ArrayList<String> data) {
        this.context = context;
        this.data = data;
    }
    
    public int getCount() {
        return data == null ? 0 : mList.size();
    }
}
```
ç„¶åå¾—å†™ä¸€ä¸ªç”¨äºè·å–å­Viewï¼ˆå°±æ˜¯TextViewï¼‰çš„æ–¹æ³•
```java
public class FlowAdapter {
    ...
    public TextView getView(int position){
        //å¡«å……å¸ƒå±€
        TextView show = (TextView) LayoutInflater.from(context).inflate(R.layout.text_layout, null);
        show.setText(data.get(position));
        return show;
    }
}
```
å¡«å……çš„å¸ƒå±€å°±å†™ä¸€ä¸ªTextViewå°±è¡Œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥newå‡ºæ¥ï¼Œè¿™é‡Œå¡«å……å¸ƒå±€æ˜¯å› ä¸ºæ‡’å¾—å†™ä»£ç ï¼Œå“ˆå“ˆï¼Œä¸‹é¢æ˜¯æˆ‘å†™çš„å¸ƒå±€
```xml
<?xml version="1.0" encoding="utf-8"?>
<TextView xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:gravity="center"
    android:id="@+id/show_text"
    android:layout_margin="5dp"
    android:background="@drawable/tv_background" />
```
emmmï¼Œä¸­è§„ä¸­çŸ©ã€‚ç„¶ååœ¨å’±å†™çš„æµå¼å¸ƒå±€é‡Œé¢ï¼Œæ¥ç€å†™setAdapteræ–¹æ³•
```java
public class FlowLayout extends ViewGroup {
    ...
    private FlowAdapter adapter;
    
    public void setAdapter(FlowAdapter adapter){
        this.adapter = adapter;
        //æ·»åŠ å­View
    }
}
```
ç„¶åå†™ä¸€ä¸ªæ–¹æ³•ç”¨äºæ·»åŠ å­Viewå°±OKäº†ã€‚ä¸ºå•¥è¦å•ç‹¬å†™ä¸€ä¸ªæ·»åŠ å­Viewçš„æ–¹æ³•ï¼Ÿæ€»ä¸èƒ½æ¯æ¬¡æ‰‹åŠ¨æ·»åŠ åéƒ½setAdapterå§ï¼Ÿè¿™æ ·æ¯•ç«Ÿä¸å¤ªå¦¥ï¼Œä¸ç¬¦åˆå¹³æ—¶ä¹ æƒ¯
```java
public class FlowLayout extends ViewGroup {
    ...
    public void refresh(){
        //å¦‚æœæ•°é‡ä¸ä¸º0
        if (adapter.getCount() != 0){
            //æ¯æ¬¡åˆ·æ–°åï¼Œå°†å½“å‰ä¸‹æ ‡
            mCurrentIndex = -1;
            //ç§»é™¤æ‰ä¹‹å‰å…¨éƒ¨çš„å­View
            removeAllViews();
            for (int i = 0; i < adapter.getCount(); i ++){
                //ç„¶åæ·»åŠ 
                View view = adapter.getView(i);
                addView(view);
            }
            //æœ€ååˆ·æ–°ç•Œé¢
            requestLayout();
        }
    }
}
```
OKï¼Œå¤§ä½“æ¡†æ¶å°±è¿™æ ·ï¼Œæ¥ä¸‹æ¥å°±è¦è€ƒè™‘ï¼šåœ¨activityä¸­ç‚¹å‡»æŒ‰é’®åé›†åˆæ•°é‡+1ï¼Œæ€ä¹ˆæ‰èƒ½è®©FlowLayoutçŸ¥é“æ•°æ®å·²ç»å˜äº†ï¼Ÿä»”ç»†è€ƒè™‘ï¼Œå¯ä»¥é€šè¿‡è§‚å¯Ÿè€…æ¥å®ç°ã€‚

åœ¨FlowAdapterä¸­å†™ä¸€ä¸ªæ¥å£ï¼Œè®©FlowLayoutå®ç°ï¼ˆä¸ºäº†æ–¹ä¾¿ï¼Œæ¥å£é‡Œçš„æ–¹æ³•å°±ç›´æ¥å†™æˆrefreshå§ï¼Œåœ¨FlowLayouté‡Œé¢å°±ä¸ç”¨æ”¹äº†ï¼‰ï¼Œç„¶ååœ¨activityä¸­è®©FlowAdapteræœ‰FlowLayoutçš„å¼•ç”¨å°±è¡Œ
```java
public class FlowAdapter {
    ...
    private OnRefresh refresh;
    public FlowAdapter(Context context, ArrayList<String> data, OnRefresh refresh) {
        this.context = context;
        this.data = data;
        this.refresh = refresh;
    }
    
    //è¯¥æ–¹æ³•ç”¨äºåˆ·æ–°é¡µé¢
    public void notifyDataSet(){
        refresh.refresh();
    }
    
    public interface OnRefresh{
        void refresh();
    }
}
```
```java
public class FlowLayout extends ViewGroup implements FlowAdapter.OnRefresh {
    ...
    //æ·»åŠ é‡å†™æ–¹æ³•çš„æ³¨è§£
    @Override
    public void refresh(){
        ...
    }
}
```
```java
public class MainActivity extends AppCompatActivity {

    private FlowLayout flowLayout;
    private FlowAdapter adapter;
    
    private ArrayList<String> stringList = new ArrayList<>();

    private int i = 0;
    private String[] strs = new String[]{
            "Eric", "Victor", "Chris", "Chad"
    };

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        flowLayout = findViewById(R.id.my_vg);

        adapter = new FlowAdapter(this, stringList, flowLayout);
        flowLayout.setAdapter(adapter);
        flowLayout.setOnCheckListener(new FlowLayout.OnTagCheckListener() {
            @Override
            public void onItemCheck(int position) {
                Toast.makeText(MainActivity.this, "click is " + stringList.get(position), Toast.LENGTH_SHORT).show();
            }
        });

        findViewById(R.id.click_btn).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                stringList.add(strs[(i ++) % strs.length]);
                adapter.notifyDataSet();
            }
        });
    }
}
```
é¡µé¢ä¹Ÿå¾ˆç®€å•
```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".MainActivity">

    <com.eric.drawmap.FlowLayout
        android:id="@+id/my_vg"
        android:layout_width="match_parent"
        android:layout_height="wrap_content">
    </com.eric.drawmap.FlowLayout>

    <Button
        android:id="@+id/click_btn"
        android:text="æ·»åŠ "
        android:layout_width="wrap_content"
        android:layout_height="wrap_content" />

</LinearLayout>
```
å¼€å§‹è¿è¡Œ....å§æ§½ãƒ¾(ï½¡ï½€Ğ”Â´ï½¡)ï¼ï¼è®¾ç½®çš„marginåˆæ— æ•ˆï¼Ÿï¼å’‹å›äº‹ï¼Ÿæ²¡å•¥é—®é¢˜å•Šï¼Ÿï¼Ÿæ‰“å°ä¸€ä¸‹marginå€¼æ˜¯å¤šå°‘....åœ¨FlowLayouté‡Œçš„onMeasureå’ŒonLayouté‡Œé¢æ‰“å°ä¸€ä¸‹ï¼Œç»“æœæ˜¯0ï¼Ÿï¼Ÿï¼Ÿå†åˆ°FlowAdapteré‡Œé¢çœ‹çœ‹FlowAdapterçš„getViewæ–¹æ³•ï¼Œæ‰“å°ä¸€ä¸‹....
```java
    @Override
    public TextView getView(int position){
        TextView show = (TextView) LayoutInflater.from(context).inflate(R.layout.text_layout, null);
        ViewGroup.LayoutParams lp = show.getLayoutParams();
        Log.i("EricLog", "lp = " + lp);
        return show;
    }
```
æ‰“å°å‡ºæ¥è¿lpéƒ½æ˜¯null....Orz....çªç„¶æƒ³åˆ°ï¼ŒLayoutParamsæ˜¯ViewGroupçš„å†…éƒ¨ç±»ï¼Œè€Œæˆ‘å†™çš„å¸ƒå±€é‡Œï¼Œæ ¹å¸ƒå±€å°±æ˜¯TextViewï¼Œæ ¹æœ¬æ²¡æœ‰ViewGroupï¼Œæ‰€ä»¥è·å–åˆ°çš„lpæ˜¯ç©º....å§æ§½ï¼Œçªç„¶é—´æç„¶å¤§æ‚Ÿã€‚æç„¶å¤§æ‚Ÿçš„åŒæ—¶ä¹Ÿæƒ³åˆ°ä¸€ç§æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼šæ—¢ç„¶æ²¡æœ‰å€¼ï¼Œé‚£å°±ç»™å®ƒä¸€ä¸ªé»˜è®¤å€¼å°±å®Œäº‹äº†
```java
public class FlowLayout extends ViewGroup {
    ...
    //é»˜è®¤marginå€¼ï¼š10ä¸ªdp
    private static final int DEFAULT_MARGIN = 10;
    
    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        ...
        if (myHeightMode == MeasureSpec.AT_MOST){
            ...
            for (int i = 0; i < childCount; i ++){
                ...
                MarginLayoutParams params = (MarginLayoutParams) childView.getLayoutParams();
                
                //æ²¡æœ‰å€¼çš„è¯ç›´æ¥ç»™å®ƒä¸€ä¸ªé»˜è®¤å€¼
                int leftMargin = params.leftMargin == 0 ? dp2px(getContext(), DEFAULT_MARGIN) : params.leftMargin;
                int rightMargin = params.rightMargin == 0 ? dp2px(getContext(), DEFAULT_MARGIN) : params.rightMargin;
                int topMargin = params.topMargin == 0 ? dp2px(getContext(), DEFAULT_MARGIN) : params.topMargin;
                int bottomMargin = params.bottomMargin == 0 ? dp2px(getContext(), DEFAULT_MARGIN) : params.bottomMargin;
                ...
            }
        }...
    }

    @Override
    protected void onLayout(boolean changed, int l, int t, int r, int b) {
        ...
        for (int i = 0; i < childCount; i ++){
            ...
            MarginLayoutParams params = (MarginLayoutParams) childView.getLayoutParams();
            
            //æ²¡æœ‰å€¼çš„è¯ç›´æ¥ç»™å®ƒä¸€ä¸ªé»˜è®¤å€¼
            int leftMargin = params.leftMargin == 0 ? dp2px(getContext(), DEFAULT_MARGIN) : params.leftMargin;
            int rightMargin = params.rightMargin == 0 ? dp2px(getContext(), DEFAULT_MARGIN) : params.rightMargin;
            int topMargin = params.topMargin == 0 ? dp2px(getContext(), DEFAULT_MARGIN) : params.topMargin;
            int bottomMargin = params.bottomMargin == 0 ? dp2px(getContext(), DEFAULT_MARGIN) : params.bottomMargin;
            ...
        }
    }
    
    /**
     * æ ¹æ®æ‰‹æœºçš„åˆ†è¾¨ç‡ä» px(åƒç´ ) çš„å•ä½ è½¬æˆä¸º dp
     */
    private static int dp2px(Context context, float pxValue) {
        final float scale = context.getResources().getDisplayMetrics().density;
        return (int) (pxValue * scale + 0.5f);
    }
}
```
å†è¿è¡Œï¼Œå®Œç¾ã€‚å†™å®Œåæƒ³åˆ°å¯ä»¥å°è£…ä¸€ä¸‹ï¼Œä¸åªå±•ç¤ºTextViewã€‚è¯´å¹²å°±å¹²ï¼ŒæŠŠadapterçš„å…·ä½“å®ç°æŠ½è±¡å‡ºæ¥ï¼Œå†æŠŠè§‚å¯Ÿè€…æ¨¡å¼ä¹ŸæŠ½è±¡å‡ºæ¥ï¼Œæ¯•ç«Ÿå®ä¾‹åŒ–adapteré‡Œé¢å†ä¼ ä¸€ä¸ªå¸ƒå±€æ„Ÿè§‰æ€ªæ€ªçš„
```java
public abstract class BaseAdapter {

    private static List<OnRefresh> onRefreshes = new ArrayList<>();

    public static void addReObj(OnRefresh refresh){
        if (!onRefreshes.contains(refresh)){
            onRefreshes.add(refresh);
        }
    }

    public static void removeReObj(OnRefresh refresh){
        onRefreshes.remove(refresh);
    }

    public static void notifyDataSetChanged(){
        for (OnRefresh onRefresh : onRefreshes){
            onRefresh.refresh();
        }
    }

    public static void clearReList(){
        onRefreshes.clear();
    }

    public interface OnRefresh{
        void refresh();
    }

    abstract int getCount();

    abstract <T extends View> T getView(int position);
}
```
ç„¶åå¯¹FlowAdapterä¿®æ”¹å¦‚ä¸‹
```java
public class FlowAdapter extends BaseAdapter {

    private Context context;
    private ArrayList<String> data;

    public FlowAdapter(Context context, ArrayList<String> data) {
        this.context = context;
        this.data = data;
    }

    public void notifyDataSet(){
        BaseAdapter.notifyDataSetChanged();
    }

    @Override
    public int getCount() {
        return data == null ? 0 : data.size();
    }

    @Override
    public TextView getView(int position){
        TextView show = (TextView) LayoutInflater.from(context).inflate(R.layout.text_layout, null);
        show.setText(data.get(position));
        return show;
    }
}
```
å¯¹FlowLayouté‡Œé¢setAdapteræ–¹æ³•ä¿®æ”¹å¦‚ä¸‹ï¼Œå¦å¤–åˆ«å¿˜äº†å®ç°çš„æ¥å£æ¢æˆBaseAdapter.OnRefresh
```java
    private BaseAdapter adapter;
    //è®¾ç½®é€‚é…å™¨
    public void setAdapter(BaseAdapter adapter){
        BaseAdapter.addReObj(this);
        this.adapter = adapter;
        refresh();
    }
```
activityé‡Œé¢ï¼Œadapterçš„å®ä¾‹åŒ–å°±ä¸éœ€è¦FlowLayoutå®ä¾‹äº†ã€‚å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆå¤šäº†

OKï¼Œè¿™ç¯‡å°±åˆ°è¿™é‡Œ
